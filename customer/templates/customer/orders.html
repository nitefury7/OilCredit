{% extends 'customer/base.html' %}
{% load crispy_forms_tags %}
{% load bootstrap_message %}

{% block main %}
<div class='container py-2'>
  <div class='d-flex flex-wrap gap-5 align-items-center justify-content-evenly'>
    <!-- canvas container container -->
    <div> <canvas id="spendings_by_product" width="400" height="400"></canvas> </div>
  </div>

  <h1 class='mt-4'>Order  History </h1>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead>
        <tr>
          <th>Item</th>
          <th>Volume</th>
          <th>Order Date</th>
          <th>Approved by</th>
        </tr>
      </thead>
      <tbody>
        {% for invoice in invoices %}
        <tr>
          <td>{{ invoice.item }}</td>
          <td>{{ invoice.volume }}</td>
          <td>{{ invoice.order_timestamp}}</td>
          <td>
              <strong>{{ invoice.employee.user.username }}</strong> 
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extrascripts %}
{{ block.super }}
<script>
  function getRandomColorWithOpacity() {
      let letters = '0123456789ABCDEF'.split('');
      let color = '#';
      for (let i = 0; i < 6; i++ ) {
          color += letters[Math.floor(Math.random() * 16)];
      }
      color += '50';
      return color;
  }

  $(document).ready(async () => {
    const ctx = document.getElementById('spendings_by_product').getContext('2d');
    let response = await fetch("{% url 'customer:spendings_by_product' %}");
    let json = await response.json();
    const myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: Object.keys(json),
        datasets: [{
          label: 'Spendings by product',
          data: Object.values(json),
          backgroundColor: Object.keys(json).map((x) => getRandomColorWithOpacity()),
          borderColor: ['#FF0000FF'],
          borderWidth: 1,
          
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

  });
</script>
{% endblock %}